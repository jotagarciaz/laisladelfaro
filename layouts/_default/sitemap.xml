{{- $pages := where (where .Site.Pages "Kind" "not in" (slice "taxonomy" "taxonomyTerm")) "Section" "not in" (slice "tags" "tag" "search") -}}
{{- $pages := where $pages "Permalink" "not in" (slice (print .Site.BaseURL "search/") (print .Site.BaseURL "blog/")) -}}
{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML -}}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {{- range $pages }}
    <url>
      <loc>{{ .Permalink | safeURL }}</loc>
      <lastmod>
        {{ with .Params.lastmod }}
          {{ . | time.Format "2006-01-02T15:04:05-07:00" }}
        {{ else }}
          {{ .Lastmod.Format "2006-01-02T15:04:05-07:00" }}
        {{ end }}
      </lastmod>
      <changefreq>monthly</changefreq>
      <priority>{{ with .Params.priority }}{{ . }}{{ else }}0.5{{ end }}</priority>
    </url>
  {{- end }}
</urlset>
